<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="optmatch">
<title>Matching in R using the optmatch and RItools packages • optmatch</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Matching in R using the optmatch and RItools packages">
<meta property="og:description" content="optmatch">
<meta name="robots" content="noindex">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">optmatch</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">0.10.2.9001</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/fullmatch-vignette.html">Matching in R using the optmatch and RItools packages</a>
    <a class="dropdown-item" href="../articles/matching-from-foreign-software.html">Using Optmatch on data in SAS, Stata, etc</a>
    <a class="dropdown-item" href="../articles/matching-within-subgroups.html">Combining Matches Within Subgroups</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/markmfredrickson/optmatch/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">



<script src="fullmatch-vignette_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <main id="main"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Matching in R using the optmatch and RItools packages</h1>
                        <h4 data-toc-skip class="author">Ben B. Hansen, Mark Fredrickson, Josh Errickson, and Josh Buckner</h4>
            
            <h4 data-toc-skip class="date">2022-05-14</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/markmfredrickson/optmatch/blob/HEAD/vignettes/fullmatch-vignette.Rmd" class="external-link"><code>vignettes/fullmatch-vignette.Rmd</code></a></small>
      <div class="d-none name"><code>fullmatch-vignette.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="the-r-environment">The <em>R</em> Environment<a class="anchor" aria-label="anchor" href="#the-r-environment"></a>
</h2>
<p>All the software used in this worksheet is freely available. The <em>R</em> statistical package is installed for you in the lab, but you may download and install <em>R</em> for Windows, Mac, and Linux systems from: <a href="https://www.r-project.org" class="external-link uri">https://www.r-project.org</a>.</p>
<p>The following document walks through a common propensity score matching work-flow in <em>R</em>. Example <em>R</em> code will appear with a <code>&gt;</code> indicating the command prompt. You may type this code yourself — each line is a command to <em>R</em>. Output will follow prefaced by <code>##</code>. (In <em>R</em>, <code>#</code> represents a comment; any command preceded by any number of <code>#</code>’s will not be executed.) For example:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="dv">2</span> <span class="op">+</span><span class="st"> </span><span class="dv">2</span></span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="co">## [1] 4</span></span></code></pre></div>
<p>(Note that when entering the code yourself, do not include the <code>&gt;</code> in your command. Also, for longer lines of code in this document, the text may wrap onto a second line, with the second line preceded by a <code>+</code> sign. When entering the code yourself, you do not have to wrap the lines, and do not include the <code>+</code>.)</p>
<p><em>R</em> stores data in named variables using the arrow operator:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a><span class="op">&gt;</span><span class="st"> </span>my.variable &lt;-<span class="st"> </span><span class="dv">2</span> <span class="op">+</span><span class="st"> </span><span class="dv">2</span></span>
<span id="cb2-2"><a href="#cb2-2"></a><span class="op">&gt;</span><span class="st"> </span>my.variable <span class="op">*</span><span class="st"> </span><span class="dv">3</span></span>
<span id="cb2-3"><a href="#cb2-3"></a><span class="co">## [1] 12</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="setup">Setup<a class="anchor" aria-label="anchor" href="#setup"></a>
</h2>
<div class="section level3">
<h3 id="outfitting-your-r-with-the-proper-add-ons">Outfitting your <em>R</em> with the proper add-ons<a class="anchor" aria-label="anchor" href="#outfitting-your-r-with-the-proper-add-ons"></a>
</h3>
<p><em>R</em> add-on packages are available to install directly from <em>R</em>:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">install.packages</span>(<span class="st">"optmatch"</span>)</span>
<span id="cb3-2"><a href="#cb3-2"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">install.packages</span>(<span class="st">"RItools"</span>)</span></code></pre></div>
<p>These commands will ask you to select a CRAN server. Any server will do. You may also be asked whether you’d like to set up a “personal library to install packages into”; if so, answer yes. (The default personal library location that <em>R</em> will suggest should be OK.) You’ll only need to run these commands the first time you want to use <strong>optmatch</strong> or <strong><a href="https://cran.r-project.org/package=RItools" class="external-link">RItools</a></strong> on a particular computer, or when you install a new version of <em>R</em>.</p>
</div>
<div class="section level3">
<h3 id="setting-up-the-r-environment-for-matching">Setting up the <em>R</em> environment for matching<a class="anchor" aria-label="anchor" href="#setting-up-the-r-environment-for-matching"></a>
</h3>
<p>Attach extension packages that we’ll be using for matching and associated diagnostics:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">library</span>(optmatch)</span>
<span id="cb4-2"><a href="#cb4-2"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">library</span>(RItools)</span></code></pre></div>
<p>You’ll do this each time you start a new <em>R</em> session and want to run matching commands.</p>
<p>To load the nuclear plants data, enter</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">data</span>(nuclearplants)</span></code></pre></div>
<p>To see the first six rows:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">head</span>(nuclearplants)</span>
<span id="cb6-2"><a href="#cb6-2"></a><span class="co">##     cost  date t1 t2  cap pr ne ct bw cum.n pt</span></span>
<span id="cb6-3"><a href="#cb6-3"></a><span class="co">## H 460.05 68.58 14 46  687  0  1  0  0    14  0</span></span>
<span id="cb6-4"><a href="#cb6-4"></a><span class="co">## I 452.99 67.33 10 73 1065  0  0  1  0     1  0</span></span>
<span id="cb6-5"><a href="#cb6-5"></a><span class="co">## A 443.22 67.33 10 85 1065  1  0  1  0     1  0</span></span>
<span id="cb6-6"><a href="#cb6-6"></a><span class="co">## J 652.32 68.00 11 67 1065  0  1  1  0    12  0</span></span>
<span id="cb6-7"><a href="#cb6-7"></a><span class="co">## B 642.23 68.00 11 78 1065  1  1  1  0    12  0</span></span>
<span id="cb6-8"><a href="#cb6-8"></a><span class="co">## K 345.39 67.92 13 51  514  0  1  1  0     3  0</span></span></code></pre></div>
<p>For more on the variables here, enter</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">help</span>(<span class="st">"nuclearplants"</span>)</span></code></pre></div>
<p>You can directly access a variable within this data frame as follows. (Try typing in the commands to see what they do.)</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a><span class="op">&gt;</span><span class="st"> </span>nuclearplants<span class="op">$</span>pt</span>
<span id="cb8-2"><a href="#cb8-2"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">table</span>(nuclearplants<span class="op">$</span>pt)</span>
<span id="cb8-3"><a href="#cb8-3"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">with</span>(nuclearplants, <span class="kw">table</span>(pt))</span></code></pre></div>
<p>The variable you will have just viewed and tabulated, <code>pt</code>, is a dummy for whether the plant was built with “partial turnkey guarantees.” These plants were not comparable to the others in terms of construction costs. Let’s exclude them for the time being, for simplicity. To do this we’ll create a data table (in <em>R</em> jargon, a “data frame”) of just those observations for which <code>pt</code> is 0:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a><span class="op">&gt;</span><span class="st"> </span>nuke.nopt &lt;-<span class="st"> </span><span class="kw">subset</span>(nuclearplants, pt <span class="op">==</span><span class="st"> </span><span class="dv">0</span>)</span></code></pre></div>
<p>To inspect its first six or last six entries, do</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">head</span>(nuke.nopt)</span>
<span id="cb10-2"><a href="#cb10-2"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">tail</span>(nuke.nopt)</span></code></pre></div>
<p>To view this as presenting a matching problem, we’ll think of plants built on the site of a previously existing plant (<code>pr == 1</code>) as the treatment group and plants on new sites (<code>pr == 0</code>) as comparisons.</p>
</div>
</div>
<div class="section level2">
<h2 id="optimal-pair-matching-and-1k-matching">Optimal pair matching and 1:k matching<a class="anchor" aria-label="anchor" href="#optimal-pair-matching-and-1k-matching"></a>
</h2>
<div class="section level3">
<h3 id="pair-matching">Pair matching<a class="anchor" aria-label="anchor" href="#pair-matching"></a>
</h3>
<p>To check the number of treated and control plants:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">table</span>(nuke.nopt<span class="op">$</span>pr)</span>
<span id="cb11-2"><a href="#cb11-2"></a><span class="co">## </span></span>
<span id="cb11-3"><a href="#cb11-3"></a><span class="co">##  0  1 </span></span>
<span id="cb11-4"><a href="#cb11-4"></a><span class="co">## 19  7</span></span></code></pre></div>
<p>To get the pair match minimizing the mean paired distance on <code>cap</code>, among all collections of 7 non-overlapping pairs, do</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">pairmatch</span>(pr <span class="op">~</span><span class="st"> </span>cap, <span class="dt">data =</span> nuke.nopt)</span>
<span id="cb12-2"><a href="#cb12-2"></a><span class="co">##    H    I    A    J    B    K    L    M    C    N    O    P    Q    R    S    T </span></span>
<span id="cb12-3"><a href="#cb12-3"></a><span class="co">## &lt;NA&gt;  1.2  1.1  1.1  1.2 &lt;NA&gt;  1.3 &lt;NA&gt;  1.3  1.7 &lt;NA&gt; &lt;NA&gt;  1.4  1.5 &lt;NA&gt; &lt;NA&gt; </span></span>
<span id="cb12-4"><a href="#cb12-4"></a><span class="co">##    U    D    V    E    W    F    X    G    Y    Z </span></span>
<span id="cb12-5"><a href="#cb12-5"></a><span class="co">##  1.6  1.4 &lt;NA&gt;  1.5 &lt;NA&gt;  1.6 &lt;NA&gt;  1.7 &lt;NA&gt; &lt;NA&gt;</span></span></code></pre></div>
<p>For a more readable report of who gets matched to whom, type</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">print</span>(<span class="kw">pairmatch</span>(pr <span class="op">~</span><span class="st"> </span>cap, <span class="dt">data =</span> nuke.nopt), <span class="dt">grouped =</span> <span class="ot">TRUE</span>)</span>
<span id="cb13-2"><a href="#cb13-2"></a><span class="co">##  Group Members</span></span>
<span id="cb13-3"><a href="#cb13-3"></a><span class="co">##    1.1    A, J</span></span>
<span id="cb13-4"><a href="#cb13-4"></a><span class="co">##    1.2    I, B</span></span>
<span id="cb13-5"><a href="#cb13-5"></a><span class="co">##    1.3    L, C</span></span>
<span id="cb13-6"><a href="#cb13-6"></a><span class="co">##    1.4    Q, D</span></span>
<span id="cb13-7"><a href="#cb13-7"></a><span class="co">##    1.5    R, E</span></span>
<span id="cb13-8"><a href="#cb13-8"></a><span class="co">##    1.6    U, F</span></span>
<span id="cb13-9"><a href="#cb13-9"></a><span class="co">##    1.7    N, G</span></span></code></pre></div>
<p>For matching on both <code>date</code> and <code>cap</code>, you’d type <code>pairmatch(pr ~ cap + date, ...)</code> instead of <code>pairmatch(pr ~ cap, ...)</code>. We’ll talk later about how this combines discrepancies on the two variables. For now, note the form of the output this command generates: a variable of the same length as the variables making up <code>nuke.nopt</code>, assigning a distinct name to each matched set. To fix your intuition, you might try connecting up below the units that <code><a href="../reference/pairmatch.html">pairmatch()</a></code> has placed in the same matched sets.</p>
<table style="width:72%;" class="table">
<caption>New-site (left columns) versus existing-site (right columns) plants. “date” is <code>date-65</code>; “capacity” is <code>cap-400</code>.</caption>
<colgroup>
<col width="11%">
<col width="9%">
<col width="15%">
<col width="11%">
<col width="9%">
<col width="15%">
</colgroup>
<thead><tr class="header">
<th align="center">Plant</th>
<th align="center">Date</th>
<th align="center">Capacity</th>
<th align="center">Plant</th>
<th align="center">Date</th>
<th align="center">Capacity</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">A</td>
<td align="center">2.3</td>
<td align="center">660</td>
<td align="center">H</td>
<td align="center">3.6</td>
<td align="center">290</td>
</tr>
<tr class="even">
<td align="center">B</td>
<td align="center">3.0</td>
<td align="center">660</td>
<td align="center">I</td>
<td align="center">2.3</td>
<td align="center">660</td>
</tr>
<tr class="odd">
<td align="center">C</td>
<td align="center">3.4</td>
<td align="center">420</td>
<td align="center">J</td>
<td align="center">3</td>
<td align="center">660</td>
</tr>
<tr class="even">
<td align="center">D</td>
<td align="center">3.4</td>
<td align="center">130</td>
<td align="center">K</td>
<td align="center">2.9</td>
<td align="center">110</td>
</tr>
<tr class="odd">
<td align="center">E</td>
<td align="center">3.9</td>
<td align="center">650</td>
<td align="center">L</td>
<td align="center">3.2</td>
<td align="center">420</td>
</tr>
<tr class="even">
<td align="center">F</td>
<td align="center">5.9</td>
<td align="center">430</td>
<td align="center">M</td>
<td align="center">3.4</td>
<td align="center">60</td>
</tr>
<tr class="odd">
<td align="center">G</td>
<td align="center">5.1</td>
<td align="center">420</td>
<td align="center">N</td>
<td align="center">3.3</td>
<td align="center">390</td>
</tr>
<tr class="even">
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="center">O</td>
<td align="center">3.6</td>
<td align="center">160</td>
</tr>
<tr class="odd">
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="center">P</td>
<td align="center">3.8</td>
<td align="center">390</td>
</tr>
<tr class="even">
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="center">Q</td>
<td align="center">3.4</td>
<td align="center">130</td>
</tr>
<tr class="odd">
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="center">R</td>
<td align="center">3.9</td>
<td align="center">650</td>
</tr>
<tr class="even">
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="center">S</td>
<td align="center">3.9</td>
<td align="center">450</td>
</tr>
<tr class="odd">
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="center">T</td>
<td align="center">3.4</td>
<td align="center">380</td>
</tr>
<tr class="even">
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="center">U</td>
<td align="center">4.5</td>
<td align="center">440</td>
</tr>
<tr class="odd">
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="center">V</td>
<td align="center">4.2</td>
<td align="center">690</td>
</tr>
<tr class="even">
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="center">W</td>
<td align="center">3.8</td>
<td align="center">510</td>
</tr>
<tr class="odd">
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="center">X</td>
<td align="center">4.7</td>
<td align="center">390</td>
</tr>
<tr class="even">
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="center">Y</td>
<td align="center">5.4</td>
<td align="center">140</td>
</tr>
<tr class="odd">
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="center">Z</td>
<td align="center">6.1</td>
<td align="center">730</td>
</tr>
</tbody>
</table>
<p>For basic summary information about this match, try</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">summary</span>(<span class="kw">pairmatch</span>(pr <span class="op">~</span><span class="st"> </span>cap, <span class="dt">data =</span> nuke.nopt))</span></code></pre></div>
<p>If you’ve already typed in the <code>pairmatch(...)</code> part, you can use the up-arrow, Home and End keys to avoid having to re-type. Alternatively, to assign the name “<code>pm</code>” to the matching result, do</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a><span class="op">&gt;</span><span class="st"> </span>pm &lt;-<span class="st"> </span><span class="kw">pairmatch</span>(pr <span class="op">~</span><span class="st"> </span>cap, <span class="dt">data =</span> nuke.nopt)</span></code></pre></div>
<p>Now, you can just type <code>print(pm, grouped = TRUE)</code> or <code>summary(pm)</code>.</p>
<p>The following would give a basic matched analysis of the effect of new or existing site on construction costs is given with the help of <em>R</em>’s linear modeling function. In effect, the existing site effect is estimated as one “way” in a two-way , the other “way” being the factor variable that represents the matching result, i.e. <code>pm</code>.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">summary</span>(<span class="kw">lm</span>(cost <span class="op">~</span><span class="st"> </span>pr <span class="op">+</span><span class="st"> </span>pm, <span class="dt">data =</span> nuke.nopt))</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="matching-with-multiple-controls">Matching with multiple controls<a class="anchor" aria-label="anchor" href="#matching-with-multiple-controls"></a>
</h3>
<p>There are other types of matches you might want to try. Here’s how to create matched triples (each treatment group unit is matched to two control group units):</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a><span class="op">&gt;</span><span class="st"> </span>tm &lt;-<span class="st"> </span><span class="kw">pairmatch</span>(pr <span class="op">~</span><span class="st"> </span>cap, <span class="dt">controls =</span> <span class="dv">2</span>, <span class="dt">data =</span> nuke.nopt)</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="did-matching-work">Did matching work?<a class="anchor" aria-label="anchor" href="#did-matching-work"></a>
</h3>
<p>It’s possible to give the software an impossible list of requirements for a match. For instance, try running the following:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">pairmatch</span>(pr <span class="op">~</span><span class="st"> </span>cap, <span class="dt">controls =</span> <span class="dv">3</span>, <span class="dt">data=</span>nuke.nopt)</span></code></pre></div>
<p>The problem here is that the data don’t have 3 comparison units to go with each treatment unit, since we have 7 treatment units but only 19 comparison units.</p>
<p>Matching can also fail because the distance matrix embodies matching constraints that are impossible to meet. In these cases the matching function will generally run without complaint, although it won’t create any matches. Here is an example, where the caliper is so narrow as to forbid all possible matches:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">pairmatch</span>(pr <span class="op">~</span><span class="st"> </span>cap <span class="op">+</span><span class="st"> </span>cost, <span class="dt">caliper=</span>.<span class="dv">001</span>, <span class="dt">data =</span> nuke.nopt)</span>
<span id="cb19-2"><a href="#cb19-2"></a><span class="co">## Warning in fullmatch.InfinitySparseMatrix(x = x, min.controls = controls, : Matching failed. (Restrictions impossible to meet?)</span></span>
<span id="cb19-3"><a href="#cb19-3"></a><span class="co">##  Enter ?matchfailed for more info.</span></span>
<span id="cb19-4"><a href="#cb19-4"></a><span class="co">##    H    I    A    J    B    K    L    M    C    N    O    P    Q    R    S    T </span></span>
<span id="cb19-5"><a href="#cb19-5"></a><span class="co">## &lt;NA&gt; &lt;NA&gt; &lt;NA&gt; &lt;NA&gt; &lt;NA&gt; &lt;NA&gt; &lt;NA&gt; &lt;NA&gt; &lt;NA&gt; &lt;NA&gt; &lt;NA&gt; &lt;NA&gt; &lt;NA&gt; &lt;NA&gt; &lt;NA&gt; &lt;NA&gt; </span></span>
<span id="cb19-6"><a href="#cb19-6"></a><span class="co">##    U    D    V    E    W    F    X    G    Y    Z </span></span>
<span id="cb19-7"><a href="#cb19-7"></a><span class="co">## &lt;NA&gt; &lt;NA&gt; &lt;NA&gt; &lt;NA&gt; &lt;NA&gt; &lt;NA&gt; &lt;NA&gt; &lt;NA&gt; &lt;NA&gt; &lt;NA&gt;</span></span></code></pre></div>
<p>Behind the scenes, the <code>caliper</code> argument restricts how the maximum distance between matched objects. For example, consider Table 1 above. Plants A and H are 1.3 units apart in <code>date</code>. If we assigned <code>caliper=1</code>, they could never be matched because they exceed the caliper limit.</p>
<p>If before matching you want to remove just the subjects lacking a counterpart within caliper distance, you can do <code>pairmatch(..., remove.unmatchables = TRUE)</code>. That won’t help with the minuscule caliper above, but with less extreme calipers it helps you salvage a few matches.</p>
</div>
<div class="section level3">
<h3 id="did-matching-balance-the-covariate">Did matching balance the covariate?<a class="anchor" aria-label="anchor" href="#did-matching-balance-the-covariate"></a>
</h3>
<p>Comparing overt biases before and after matching. An assessment of the unmatched difference between the groups on <code>cap</code> can be had via:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1"></a><span class="op">&gt;</span><span class="st"> </span>cap.noadj &lt;-<span class="st"> </span><span class="kw">lm</span>(cap <span class="op">~</span><span class="st"> </span>pr, <span class="dt">data =</span> nuke.nopt)</span>
<span id="cb20-2"><a href="#cb20-2"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">summary</span>(cap.noadj)</span></code></pre></div>
<p>The output is suppressed, as most of it is not relevant to balance. This variation hones in on the part that is:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">summary</span>(<span class="kw">lm</span>(cap <span class="op">~</span><span class="st"> </span>pr, <span class="dt">data =</span> nuke.nopt))<span class="op">$</span>coeff[<span class="st">"pr"</span>,]</span>
<span id="cb21-2"><a href="#cb21-2"></a><span class="co">##   Estimate Std. Error    t value   Pr(&gt;|t|) </span></span>
<span id="cb21-3"><a href="#cb21-3"></a><span class="co">## 79.7368421 92.7031668  0.8601307  0.3982280</span></span></code></pre></div>
<p>(Note again the use of square brackets, <code>[</code> and <code>]</code>, for specifying subsets of a matrix. With <em>R</em> one has to carefully distinguish square brackets, curly brackets and parentheses.)</p>
<p>Here is a parallel calculation that takes the match <code>pm</code> into account.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">summary</span>(<span class="kw">lm</span>(cap <span class="op">~</span><span class="st"> </span>pr <span class="op">+</span><span class="st"> </span>pm, <span class="dt">data =</span> nuke.nopt))<span class="op">$</span>coeff[<span class="st">"pr"</span>,]</span>
<span id="cb22-2"><a href="#cb22-2"></a><span class="co">##   Estimate Std. Error    t value   Pr(&gt;|t|) </span></span>
<span id="cb22-3"><a href="#cb22-3"></a><span class="co">##  1.7142857  5.1395492  0.3335479  0.7500689</span></span></code></pre></div>
<p>The <strong><a href="https://cran.r-project.org/package=RItools" class="external-link">RItools</a></strong> package’s <code>xBalance</code> function zeroes in on balance, and facilitates checking balance on multiple variables at the same time. Here are some examples:</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1"></a><span class="op">&gt;</span><span class="st"> </span></span>
<span id="cb23-2"><a href="#cb23-2"></a><span class="er">&gt;</span><span class="st"> </span><span class="kw">xBalance</span>(pr <span class="op">~</span><span class="st"> </span>cap <span class="op">+</span><span class="st"> </span>t2, <span class="dt">report=</span><span class="st">"all"</span>, <span class="dt">data=</span>nuke.nopt)</span>
<span id="cb23-3"><a href="#cb23-3"></a><span class="co">##      strata unstrat                                                           </span></span>
<span id="cb23-4"><a href="#cb23-4"></a><span class="co">##      stat      pr=0    pr=1 adj.diff adj.diff.null.sd std.diff    z           </span></span>
<span id="cb23-5"><a href="#cb23-5"></a><span class="co">## vars                                                                          </span></span>
<span id="cb23-6"><a href="#cb23-6"></a><span class="co">## cap         803.263 883.000  79.737           92.220   0.380   0.865          </span></span>
<span id="cb23-7"><a href="#cb23-7"></a><span class="co">## t2          59.526  66.857   7.331            4.547    0.738   1.612          </span></span>
<span id="cb23-8"><a href="#cb23-8"></a><span class="co">## ---Overall Test---</span></span>
<span id="cb23-9"><a href="#cb23-9"></a><span class="co">##         chisquare df p.value</span></span>
<span id="cb23-10"><a href="#cb23-10"></a><span class="co">## unstrat      2.71  2   0.258</span></span>
<span id="cb23-11"><a href="#cb23-11"></a><span class="co">## ---</span></span>
<span id="cb23-12"><a href="#cb23-12"></a><span class="co">## Signif. codes:  0 '***' 0.001 '** ' 0.01 '*  ' 0.05 '.  ' 0.1 '   ' 1</span></span>
<span id="cb23-13"><a href="#cb23-13"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">xBalance</span>(pr <span class="op">~</span><span class="st"> </span>cap <span class="op">+</span><span class="st"> </span>t2,</span>
<span id="cb23-14"><a href="#cb23-14"></a><span class="op">+</span><span class="st">          </span><span class="dt">strata=</span> pm,</span>
<span id="cb23-15"><a href="#cb23-15"></a><span class="op">+</span><span class="st">          </span><span class="dt">data=</span>nuke.nopt,</span>
<span id="cb23-16"><a href="#cb23-16"></a><span class="op">+</span><span class="st">          </span><span class="dt">report=</span><span class="kw">c</span>(<span class="st">"adj.mean.diffs"</span>, <span class="st">"std"</span>, <span class="st">"z"</span>))</span>
<span id="cb23-17"><a href="#cb23-17"></a><span class="co">##      strata    strat                         </span></span>
<span id="cb23-18"><a href="#cb23-18"></a><span class="co">##      stat   adj.diff std.diff    z           </span></span>
<span id="cb23-19"><a href="#cb23-19"></a><span class="co">## vars                                         </span></span>
<span id="cb23-20"><a href="#cb23-20"></a><span class="co">## cap          1.71429  0.00818 0.35698        </span></span>
<span id="cb23-21"><a href="#cb23-21"></a><span class="co">## t2           4.71429  0.47444 1.16892</span></span></code></pre></div>
<p><strong>Exercises.</strong></p>
<ol style="list-style-type: decimal">
<li>Compare <code>pm</code>, <code>tm</code> and the unmatched samples in terms of balance on <code>t2</code>.</li>
<li>Compare <code>pm</code>, <code>tm</code> and the unmatched samples in terms of balance on <code>date</code>.</li>
<li>Compare <code>pm</code> to Mahalanobis pair matching on <code>t1</code> in terms of balance on <code>date</code>.</li>
<li>Compare Mahalanobis pair matching on <code>cap</code> and <code>date</code> to Mahalanobis pair matching on <code>cap</code>, <code>date</code> and each of <code>t1,t2</code>. Add the last two variables in one at a time, so that you’re comparing a total of three matches. Compare on balance in <code>cap</code> and <code>t2</code>.</li>
</ol>
<p>Section “Checking balance in general”, below, presents convenient ways to do balance assessment for many variables at once. Before getting to that let’s discuss try matching with propensity scores.</p>
</div>
</div>
<div class="section level2">
<h2 id="propensity-score-matching">Propensity Score Matching<a class="anchor" aria-label="anchor" href="#propensity-score-matching"></a>
</h2>
<div class="section level3">
<h3 id="propensity-score-fitting-in-r">Propensity score fitting in <em>R</em><a class="anchor" aria-label="anchor" href="#propensity-score-fitting-in-r"></a>
</h3>
<p>Logistic regression models are fit in <em>R</em> using the function <code><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm()</a></code>, with <code>family</code> argument set to <code>binomial</code>. Example:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1"></a><span class="op">&gt;</span><span class="st"> </span>psm &lt;-<span class="st"> </span><span class="kw">glm</span>(pr <span class="op">~</span><span class="st"> </span>date <span class="op">+</span><span class="st"> </span>t1 <span class="op">+</span><span class="st"> </span>t2 <span class="op">+</span><span class="st"> </span>cap <span class="op">+</span><span class="st"> </span>ne <span class="op">+</span><span class="st"> </span>ct <span class="op">+</span><span class="st"> </span>bw <span class="op">+</span><span class="st"> </span>cum.n <span class="op">+</span><span class="st"> </span>pt,</span>
<span id="cb24-2"><a href="#cb24-2"></a><span class="op">+</span><span class="st">            </span><span class="dt">family =</span> binomial, <span class="dt">data =</span> nuclearplants)</span></code></pre></div>
<p>The fitted logistic regression is then stored in the object <code>psm</code>. The propensity scores can be accessed with <code>psm$fitted.values</code> (estimated probabilities) or <code>scores(psm)</code> (estimated logits of probabilities).</p>
<p>It’s often a good idea to compare the groups’ distributions on the propensity score.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">boxplot</span>(psm)</span></code></pre></div>
<p><img src="fullmatch-vignette_files/figure-html/unnamed-chunk-29-1.png" width="480"></p>
<p>The groups do overlap, if not greatly. It may be wise to restrict the sample to the region of overlap, at least roughly. A propensity caliper would help with this.</p>
<p>First, let’s match directly on the propensity score without restricting the sample to the region of overlap.</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1"></a><span class="op">&gt;</span><span class="st"> </span>ps.pm &lt;-<span class="st"> </span><span class="kw">pairmatch</span>(psm, <span class="dt">data =</span> nuclearplants)</span>
<span id="cb26-2"><a href="#cb26-2"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">summary</span>(ps.pm)</span>
<span id="cb26-3"><a href="#cb26-3"></a><span class="co">## Structure of matched sets:</span></span>
<span id="cb26-4"><a href="#cb26-4"></a><span class="co">## 1:1 0:1 </span></span>
<span id="cb26-5"><a href="#cb26-5"></a><span class="co">##  10  12 </span></span>
<span id="cb26-6"><a href="#cb26-6"></a><span class="co">## Effective Sample Size:  10 </span></span>
<span id="cb26-7"><a href="#cb26-7"></a><span class="co">## (equivalent number of matched pairs).</span></span></code></pre></div>
<p>To restrict to the overlapping region, we want to imply a caliper to the distances generated by the propensity score model. To do this requires a more explicit generation of the match, involving separate steps for generation of the distances followed by matching upon those distances.</p>
<p>First, we create a distance matrix based upon <code>psm</code>:</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1"></a><span class="op">&gt;</span><span class="st"> </span>psm.dist &lt;-<span class="st"> </span><span class="kw">match_on</span>(psm, <span class="dt">data=</span>nuclearplants)</span></code></pre></div>
<p><code>psm.dist</code> is a matrix with an entry corresponding to the distance between each potential pair of treatment and control units. We can caliper directly on this distance matrix,</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">caliper</span>(psm.dist, <span class="dv">2</span>)</span>
<span id="cb28-2"><a href="#cb28-2"></a><span class="co">##        control</span></span>
<span id="cb28-3"><a href="#cb28-3"></a><span class="co">## treated   H   I   J   K   L   M   N   O   P   Q   R   S   T U   V   W   X   Y</span></span>
<span id="cb28-4"><a href="#cb28-4"></a><span class="co">##       A Inf Inf Inf Inf Inf Inf Inf Inf Inf Inf Inf Inf Inf 0   0 Inf Inf Inf</span></span>
<span id="cb28-5"><a href="#cb28-5"></a><span class="co">##       B Inf   0 Inf Inf Inf   0   0   0 Inf   0   0   0   0 0   0   0 Inf Inf</span></span>
<span id="cb28-6"><a href="#cb28-6"></a><span class="co">##       C Inf   0   0 Inf Inf   0   0   0 Inf   0   0   0   0 0 Inf   0   0 Inf</span></span>
<span id="cb28-7"><a href="#cb28-7"></a><span class="co">##       D Inf Inf Inf Inf Inf Inf Inf Inf Inf Inf Inf   0 Inf 0   0 Inf Inf Inf</span></span>
<span id="cb28-8"><a href="#cb28-8"></a><span class="co">##       E Inf   0 Inf Inf Inf   0   0   0 Inf   0   0   0   0 0   0   0   0 Inf</span></span>
<span id="cb28-9"><a href="#cb28-9"></a><span class="co">##       F Inf   0 Inf Inf Inf   0 Inf   0 Inf Inf   0   0   0 0   0 Inf Inf Inf</span></span>
<span id="cb28-10"><a href="#cb28-10"></a><span class="co">##       G Inf   0 Inf Inf Inf   0   0   0 Inf   0   0   0   0 0   0   0 Inf Inf</span></span>
<span id="cb28-11"><a href="#cb28-11"></a><span class="co">##       a Inf   0 Inf Inf Inf Inf Inf Inf Inf Inf   0   0   0 0   0 Inf Inf Inf</span></span>
<span id="cb28-12"><a href="#cb28-12"></a><span class="co">##       b Inf Inf Inf Inf Inf Inf Inf Inf Inf Inf Inf Inf Inf 0   0 Inf Inf Inf</span></span>
<span id="cb28-13"><a href="#cb28-13"></a><span class="co">##       c Inf   0 Inf Inf Inf   0   0   0 Inf   0   0   0   0 0   0   0 Inf Inf</span></span>
<span id="cb28-14"><a href="#cb28-14"></a><span class="co">##        control</span></span>
<span id="cb28-15"><a href="#cb28-15"></a><span class="co">## treated   Z d   e   f</span></span>
<span id="cb28-16"><a href="#cb28-16"></a><span class="co">##       A Inf 0 Inf Inf</span></span>
<span id="cb28-17"><a href="#cb28-17"></a><span class="co">##       B   0 0 Inf   0</span></span>
<span id="cb28-18"><a href="#cb28-18"></a><span class="co">##       C   0 0 Inf   0</span></span>
<span id="cb28-19"><a href="#cb28-19"></a><span class="co">##       D Inf 0 Inf Inf</span></span>
<span id="cb28-20"><a href="#cb28-20"></a><span class="co">##       E   0 0 Inf   0</span></span>
<span id="cb28-21"><a href="#cb28-21"></a><span class="co">##       F   0 0 Inf   0</span></span>
<span id="cb28-22"><a href="#cb28-22"></a><span class="co">##       G   0 0 Inf   0</span></span>
<span id="cb28-23"><a href="#cb28-23"></a><span class="co">##       a   0 0 Inf   0</span></span>
<span id="cb28-24"><a href="#cb28-24"></a><span class="co">##       b Inf 0 Inf Inf</span></span>
<span id="cb28-25"><a href="#cb28-25"></a><span class="co">##       c   0 0 Inf   0</span></span></code></pre></div>
<p>Entries which are <code>Inf</code> will never be matched. Adding the caliper to <code>psm.dist</code> will disallow matching between units which differ by more than 2 standard deviations.</p>
<p>(Note that this differs from the previous use of <code>caliper</code> directly in <code>pairmatch</code>, where the caliper is applied directly to the distances instead of smartly upon the standard deviations between the propensity scores.)</p>
<p>Combining the above, we can now</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1"></a><span class="op">&gt;</span><span class="st"> </span>ps.pm2 &lt;-<span class="st"> </span><span class="kw">pairmatch</span>(psm.dist, <span class="dt">data =</span> nuclearplants)</span>
<span id="cb29-2"><a href="#cb29-2"></a><span class="op">&gt;</span><span class="st"> </span>ps.pm3 &lt;-<span class="st"> </span><span class="kw">pairmatch</span>(psm.dist <span class="op">+</span><span class="st"> </span><span class="kw">caliper</span>(psm.dist, <span class="dv">2</span>), <span class="dt">data =</span> nuclearplants)</span>
<span id="cb29-3"><a href="#cb29-3"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">all.equal</span>(ps.pm, ps.pm2, <span class="dt">check.attributes=</span><span class="ot">FALSE</span>)</span>
<span id="cb29-4"><a href="#cb29-4"></a><span class="co">## [1] TRUE</span></span>
<span id="cb29-5"><a href="#cb29-5"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">all.equal</span>(ps.pm, ps.pm3, <span class="dt">check.attributes=</span><span class="ot">FALSE</span>)</span>
<span id="cb29-6"><a href="#cb29-6"></a><span class="co">## [1] "8 string mismatches"</span></span>
<span id="cb29-7"><a href="#cb29-7"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">summary</span>(ps.pm3)</span>
<span id="cb29-8"><a href="#cb29-8"></a><span class="co">## Structure of matched sets:</span></span>
<span id="cb29-9"><a href="#cb29-9"></a><span class="co">## 1:1 0:1 </span></span>
<span id="cb29-10"><a href="#cb29-10"></a><span class="co">##  10  12 </span></span>
<span id="cb29-11"><a href="#cb29-11"></a><span class="co">## Effective Sample Size:  10 </span></span>
<span id="cb29-12"><a href="#cb29-12"></a><span class="co">## (equivalent number of matched pairs).</span></span></code></pre></div>
<p>Or you could match within calipers of the propensity score on some other distance, perhaps Mahalanobis distances based on selected covariates as recommended by Rubin and Thomas (2000, JASA) and others. For Mahalanobis matching on <code>date</code>, <code>cap</code> and the propensity score, for instance, combined with a propensity caliper of 1 pooled sd.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1"></a><span class="op">&gt;</span><span class="st"> </span>mhd1 &lt;-<span class="st"> </span><span class="kw">match_on</span>(pr <span class="op">~</span><span class="st"> </span>date <span class="op">+</span><span class="st"> </span>cap <span class="op">+</span><span class="st"> </span><span class="kw">scores</span>(psm), <span class="dt">data=</span>nuclearplants)</span>
<span id="cb30-2"><a href="#cb30-2"></a><span class="op">&gt;</span><span class="st"> </span>mhpc.pm &lt;-<span class="st"> </span><span class="kw">pairmatch</span>(mhd1, <span class="dt">caliper=</span><span class="dv">1</span>, <span class="dt">data=</span>nuclearplants)</span>
<span id="cb30-3"><a href="#cb30-3"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">summary</span>(mhpc.pm) <span class="co"># oops</span></span>
<span id="cb30-4"><a href="#cb30-4"></a><span class="co">## Structure of matched sets:</span></span>
<span id="cb30-5"><a href="#cb30-5"></a><span class="co">## 1:1 0:1 </span></span>
<span id="cb30-6"><a href="#cb30-6"></a><span class="co">##  10  12 </span></span>
<span id="cb30-7"><a href="#cb30-7"></a><span class="co">## Effective Sample Size:  10 </span></span>
<span id="cb30-8"><a href="#cb30-8"></a><span class="co">## (equivalent number of matched pairs).</span></span>
<span id="cb30-9"><a href="#cb30-9"></a><span class="op">&gt;</span><span class="st"> </span>mhpc.pm &lt;-<span class="st"> </span><span class="kw">pairmatch</span>(mhd1, <span class="dt">caliper=</span><span class="dv">2</span>, <span class="dt">data=</span>nuclearplants)</span>
<span id="cb30-10"><a href="#cb30-10"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">summary</span>(mhpc.pm) <span class="co"># better!</span></span>
<span id="cb30-11"><a href="#cb30-11"></a><span class="co">## Structure of matched sets:</span></span>
<span id="cb30-12"><a href="#cb30-12"></a><span class="co">## 1:1 0:1 </span></span>
<span id="cb30-13"><a href="#cb30-13"></a><span class="co">##  10  12 </span></span>
<span id="cb30-14"><a href="#cb30-14"></a><span class="co">## Effective Sample Size:  10 </span></span>
<span id="cb30-15"><a href="#cb30-15"></a><span class="co">## (equivalent number of matched pairs).</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="checking-balance-in-general">Checking balance in general<a class="anchor" aria-label="anchor" href="#checking-balance-in-general"></a>
</h3>
<p>The <strong><a href="https://cran.r-project.org/package=RItools" class="external-link">RItools</a></strong> package has a convenient function for checking balance on many variables simultaneously. To get a sense of what it does, try this:</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">library</span>(RItools)</span>
<span id="cb31-2"><a href="#cb31-2"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">xBalance</span>(pr <span class="op">~</span><span class="st"> </span>date <span class="op">+</span><span class="st"> </span>t1 <span class="op">+</span><span class="st"> </span>t2 <span class="op">+</span><span class="st"> </span>cap <span class="op">+</span><span class="st"> </span>ne <span class="op">+</span><span class="st"> </span>ct <span class="op">+</span><span class="st"> </span>bw <span class="op">+</span><span class="st"> </span>cum.n, <span class="dt">data =</span> nuclearplants)</span>
<span id="cb31-3"><a href="#cb31-3"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">xBalance</span>(pr <span class="op">~</span><span class="st"> </span>date <span class="op">+</span><span class="st"> </span>t1 <span class="op">+</span><span class="st"> </span>t2 <span class="op">+</span><span class="st"> </span>cap <span class="op">+</span><span class="st"> </span>ne <span class="op">+</span><span class="st"> </span>ct <span class="op">+</span><span class="st"> </span>bw <span class="op">+</span><span class="st"> </span>cum.n <span class="op">+</span><span class="st"> </span>pt <span class="op">+</span></span>
<span id="cb31-4"><a href="#cb31-4"></a><span class="op">+</span><span class="st">              </span><span class="kw">strata</span>(ps.pm2) <span class="dv">-1</span>, <span class="co"># the `-1` just focuses the output a little</span></span>
<span id="cb31-5"><a href="#cb31-5"></a><span class="op">+</span><span class="st">          </span><span class="dt">data =</span> nuclearplants)</span></code></pre></div>
<p>It can in the same display compare matching to no matching, on any of a number of axes. Here is a demonstration:</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1"></a><span class="op">&gt;</span><span class="st"> </span>myb &lt;-<span class="st"> </span><span class="kw">xBalance</span>(pr <span class="op">~</span><span class="st"> </span>date <span class="op">+</span><span class="st"> </span>t1 <span class="op">+</span><span class="st"> </span>t2 <span class="op">+</span><span class="st"> </span>cap <span class="op">+</span><span class="st"> </span>ne <span class="op">+</span><span class="st"> </span>ct <span class="op">+</span><span class="st"> </span>bw <span class="op">+</span><span class="st"> </span>cum.n <span class="op">+</span></span>
<span id="cb32-2"><a href="#cb32-2"></a><span class="op">+</span><span class="st">                 </span><span class="kw">strata</span>(ps.pm2),</span>
<span id="cb32-3"><a href="#cb32-3"></a><span class="op">+</span><span class="st">                 </span><span class="dt">data =</span> nuclearplants,</span>
<span id="cb32-4"><a href="#cb32-4"></a><span class="op">+</span><span class="st">                 </span><span class="dt">report =</span> <span class="kw">c</span>(<span class="st">"adj.means"</span>, <span class="st">"std.diffs"</span>,</span>
<span id="cb32-5"><a href="#cb32-5"></a><span class="op">+</span><span class="st">                            "z.scores"</span>, <span class="st">"chisquare.test"</span>))</span>
<span id="cb32-6"><a href="#cb32-6"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">plot</span>(myb)</span></code></pre></div>
<p><img src="fullmatch-vignette_files/figure-html/unnamed-chunk-36-1.png" width="480"></p>
<pre><code>## NULL
&gt; print(myb, digits=1)
##       strata  Unadj                                ps.pm2                               
##       stat     pr=0   pr=1 std.diff    z             pr=0   pr=1 std.diff    z          
## vars                                                                                    
## date         68.62  68.50    -0.11   -0.31         68.68  68.50    -0.18   -0.29        
## t1           13.64  14.00    0.11    0.28          14.30  14.00    -0.09   -0.15        
## t2           59.32  69.10    1.03    2.47   *      62.60  69.10    0.69    1.39         
## cap          805.18 869.80   0.34    0.89          889.60 869.80   -0.10   -0.28        
## ne           0.27   0.20     -0.16   -0.43         0.10   0.20     0.22    0.58         
## ct           0.45   0.30     -0.31   -0.81         0.20   0.30     0.20    0.45         
## bw           0.18   0.20     0.05    0.12          0.20   0.20     0.00    0.00         
## cum.n        8.73   8.10     -0.10   -0.26         8.60   8.10     -0.08   -0.22        
## ---Overall Test---
##        chisquare df p.value
## Unadj         11  8     0.2
## ps.pm2         8  8     0.4
## ---
## Signif. codes:  0 '***' 0.001 '** ' 0.01 '*  ' 0.05 '.  ' 0.1 '   ' 1</code></pre>
<p>For a very compact representation of the assessment, call <code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code> on the match, passing along the fitted propensity model as a second argument. If you’ve got <strong><a href="https://cran.r-project.org/package=RItools" class="external-link">RItools</a></strong> loaded, then this will call <code>xBalance</code> in the background, reporting the summary chi-square test results.</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">summary</span>(ps.pm2, psm)</span>
<span id="cb34-2"><a href="#cb34-2"></a><span class="co">## Structure of matched sets:</span></span>
<span id="cb34-3"><a href="#cb34-3"></a><span class="co">## 1:1 0:1 </span></span>
<span id="cb34-4"><a href="#cb34-4"></a><span class="co">##  10  12 </span></span>
<span id="cb34-5"><a href="#cb34-5"></a><span class="co">## Effective Sample Size:  10 </span></span>
<span id="cb34-6"><a href="#cb34-6"></a><span class="co">## (equivalent number of matched pairs).</span></span>
<span id="cb34-7"><a href="#cb34-7"></a><span class="co">## </span></span>
<span id="cb34-8"><a href="#cb34-8"></a><span class="co">## Balance test overall result:</span></span>
<span id="cb34-9"><a href="#cb34-9"></a><span class="co">##   chisquare df p.value</span></span>
<span id="cb34-10"><a href="#cb34-10"></a><span class="co">##        9.96  9   0.354</span></span></code></pre></div>
<p><strong>Exercise.</strong></p>
<p>Try out {at least 3} different combinations of propensity score and Mahalanobis matching. Identify the matches that gives:</p>
<ol style="list-style-type: decimal">
<li>the “best balance overall,” as measured by Chi-square statistics;</li>
<li>the “best balance overall,” as indicated by the largest standardized difference among the covariates;</li>
<li>the best balance on <code>date</code> and <code>cap</code>, as measured by the larger of the standardized differences for these two variables; and</li>
<li>the best balance on <code>date</code> and <code>cap</code>, as measured by the larger of the standardized differences for these two variables, among those matches for which the overall imbalance <em>p</em>-value is no more than .1.</li>
</ol>
</div>
</div>
<div class="section level2">
<h2 id="other-topics-in-matching">Other topics in matching<a class="anchor" aria-label="anchor" href="#other-topics-in-matching"></a>
</h2>
<div class="section level3">
<h3 id="full-matching-and-matching-with-a-varying-number-of-controls">Full matching and matching with a varying number of controls<a class="anchor" aria-label="anchor" href="#full-matching-and-matching-with-a-varying-number-of-controls"></a>
</h3>
<p>Try out for yourself and compare:</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">summary</span>(<span class="kw">fullmatch</span>(pr <span class="op">~</span><span class="st"> </span>date <span class="op">+</span><span class="st"> </span>cap, <span class="dt">data =</span> nuke.nopt))</span>
<span id="cb35-2"><a href="#cb35-2"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">summary</span>(<span class="kw">fullmatch</span>(pr <span class="op">~</span><span class="st"> </span>date <span class="op">+</span><span class="st"> </span>cap, <span class="dt">data =</span> nuke.nopt, <span class="dt">min =</span> <span class="dv">1</span>))</span>
<span id="cb35-3"><a href="#cb35-3"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">summary</span>(<span class="kw">fullmatch</span>(pr <span class="op">~</span><span class="st"> </span>date <span class="op">+</span><span class="st"> </span>cap, <span class="dt">data =</span> nuke.nopt, <span class="dt">min =</span> <span class="dv">2</span>, <span class="dt">max =</span> <span class="dv">3</span>))</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="subclassification-before-matching">Subclassification before matching<a class="anchor" aria-label="anchor" href="#subclassification-before-matching"></a>
</h3>
<p>Recall that the data set <code>nuclearplants</code> had 32 observations, 6 of which we excluded. These were plants built under “partial turnkey” guarantees (<code>pt == 1</code>), for which costs are difficult to compare with other plants. We might include the excluded plants by matching them only among themselves. Then we need to subclassify prior to matching.</p>
<p>This is a common and useful operation, and <strong>optmatch</strong> is designed to help you do it via a <code>strata</code> term in the matching formula.</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">pairmatch</span>(pr <span class="op">~</span><span class="st"> </span>date <span class="op">+</span><span class="st"> </span>cap <span class="op">+</span><span class="st"> </span><span class="kw">scores</span>(psm), <span class="dt">data=</span>nuclearplants)</span>
<span id="cb36-2"><a href="#cb36-2"></a><span class="co">##    H    I    A    J    B    K    L    M    C    N    O    P    Q    R    S    T </span></span>
<span id="cb36-3"><a href="#cb36-3"></a><span class="co">## &lt;NA&gt;  1.2  1.2 &lt;NA&gt;  1.4 &lt;NA&gt; &lt;NA&gt;  1.7  1.6  1.6 &lt;NA&gt; &lt;NA&gt; &lt;NA&gt;  1.4 &lt;NA&gt;  1.1 </span></span>
<span id="cb36-4"><a href="#cb36-4"></a><span class="co">##    U    D    V    E    W    F    X    G    Y    Z    d    e    f    a    b    c </span></span>
<span id="cb36-5"><a href="#cb36-5"></a><span class="co">## 1.10  1.7  1.8  1.8 &lt;NA&gt;  1.9  1.9 1.10 &lt;NA&gt; &lt;NA&gt;  1.3 &lt;NA&gt;  1.5  1.1  1.3  1.5</span></span>
<span id="cb36-6"><a href="#cb36-6"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">pairmatch</span>(pr <span class="op">~</span><span class="st"> </span>date <span class="op">+</span><span class="st"> </span>cap <span class="op">+</span><span class="st"> </span><span class="kw">scores</span>(psm) <span class="op">+</span><span class="st"> </span><span class="kw">strata</span>(pt), <span class="dt">data=</span>nuclearplants)</span>
<span id="cb36-7"><a href="#cb36-7"></a><span class="co">##    H    I    A    J    B    K    L    M    C    N    O    P    Q    R    S    T </span></span>
<span id="cb36-8"><a href="#cb36-8"></a><span class="co">## &lt;NA&gt;  0.1  0.1 &lt;NA&gt;  0.2 &lt;NA&gt; &lt;NA&gt;  0.4  0.3  0.3 &lt;NA&gt; &lt;NA&gt; &lt;NA&gt;  0.2 &lt;NA&gt; &lt;NA&gt; </span></span>
<span id="cb36-9"><a href="#cb36-9"></a><span class="co">##    U    D    V    E    W    F    X    G    Y    Z    d    e    f    a    b    c </span></span>
<span id="cb36-10"><a href="#cb36-10"></a><span class="co">##  0.7  0.4  0.5  0.5 &lt;NA&gt;  0.6  0.6  0.7 &lt;NA&gt; &lt;NA&gt;  1.2  1.1  1.3  1.1  1.2  1.3</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="distances">Distances<a class="anchor" aria-label="anchor" href="#distances"></a>
</h3>
<p>You’ll often want to do several variations on a match. It may save computation and typing time to store the distance you’re using to match, if you’re going to re-use that distance. To do so, you’ll have to explicitly separate distance-making and matching, two steps that we’ve merged together thus far. We’ll use the <code><a href="../reference/match_on-methods.html">match_on()</a></code> to create distances.</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1"></a><span class="op">&gt;</span><span class="st"> </span>cap.dist &lt;-<span class="st"> </span><span class="kw">match_on</span>(pr <span class="op">~</span><span class="st"> </span>cap, <span class="dt">data =</span> nuke.nopt)</span>
<span id="cb37-2"><a href="#cb37-2"></a><span class="op">&gt;</span><span class="st"> </span>pm1 &lt;-<span class="st"> </span><span class="kw">pairmatch</span>(pr <span class="op">~</span><span class="st"> </span>cap, <span class="dt">data=</span>nuke.nopt)</span>
<span id="cb37-3"><a href="#cb37-3"></a><span class="op">&gt;</span><span class="st"> </span>pm2 &lt;-<span class="st"> </span><span class="kw">pairmatch</span>(cap.dist, <span class="dt">data=</span>nuke.nopt)</span>
<span id="cb37-4"><a href="#cb37-4"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">all.equal</span>(pm1, pm2, <span class="dt">check.attributes =</span> <span class="ot">FALSE</span>)</span>
<span id="cb37-5"><a href="#cb37-5"></a><span class="co">## [1] TRUE</span></span>
<span id="cb37-6"><a href="#cb37-6"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">summary</span>(pm2)</span>
<span id="cb37-7"><a href="#cb37-7"></a><span class="co">## Structure of matched sets:</span></span>
<span id="cb37-8"><a href="#cb37-8"></a><span class="co">## 1:1 0:1 </span></span>
<span id="cb37-9"><a href="#cb37-9"></a><span class="co">##   7  12 </span></span>
<span id="cb37-10"><a href="#cb37-10"></a><span class="co">## Effective Sample Size:  7 </span></span>
<span id="cb37-11"><a href="#cb37-11"></a><span class="co">## (equivalent number of matched pairs).</span></span></code></pre></div>
<p>What does a matching distance look like? Here’s the upper-left corner of one of them:</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">round</span>(cap.dist[<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">3</span>], <span class="dv">1</span>)</span>
<span id="cb38-2"><a href="#cb38-2"></a><span class="co">##          control</span></span>
<span id="cb38-3"><a href="#cb38-3"></a><span class="co">## treatment   H   I   J</span></span>
<span id="cb38-4"><a href="#cb38-4"></a><span class="co">##         A 1.8 0.0 0.0</span></span>
<span id="cb38-5"><a href="#cb38-5"></a><span class="co">##         B 1.8 0.0 0.0</span></span>
<span id="cb38-6"><a href="#cb38-6"></a><span class="co">##         C 0.6 1.2 1.2</span></span></code></pre></div>
<p>(Note the use of square brackets, <code>[</code> and <code>]</code>, for specifying rows and columns of the distance matrix. If you find that this isn’t working on a distance that you’ve produced, try <code>as.matrix(my.dist)[1:3,1:3]</code> or similar.)</p>
<p>Matching with a caliper of 2 pooled standard deviations on the <code>cap</code> variable:</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">round</span>(cap.dist <span class="op">+</span><span class="st"> </span><span class="kw">caliper</span>(cap.dist, <span class="dv">2</span>), <span class="dv">1</span>)</span>
<span id="cb39-2"><a href="#cb39-2"></a><span class="co">##        control</span></span>
<span id="cb39-3"><a href="#cb39-3"></a><span class="co">## treated   H   I   J   K   L   M   N   O   P   Q   R   S   T   U   V   W   X   Y</span></span>
<span id="cb39-4"><a href="#cb39-4"></a><span class="co">##       A 1.8 0.0 0.0 Inf 1.2 Inf 1.3 Inf 1.3 Inf 0.1 1.0 1.4 1.0 0.1 0.7 1.3 Inf</span></span>
<span id="cb39-5"><a href="#cb39-5"></a><span class="co">##       B 1.8 0.0 0.0 Inf 1.2 Inf 1.3 Inf 1.3 Inf 0.1 1.0 1.4 1.0 0.1 0.7 1.3 Inf</span></span>
<span id="cb39-6"><a href="#cb39-6"></a><span class="co">##       C 0.6 1.2 1.2 1.5 0.0 1.7 0.1 1.2 0.2 1.4 1.1 0.1 0.2 0.1 1.3 0.4 0.2 1.4</span></span>
<span id="cb39-7"><a href="#cb39-7"></a><span class="co">##       D 0.7 Inf Inf 0.1 1.4 0.3 1.2 0.1 1.2 0.0 Inf 1.5 1.2 1.5 Inf 1.8 1.2 0.0</span></span>
<span id="cb39-8"><a href="#cb39-8"></a><span class="co">##       E 1.7 0.1 0.1 Inf 1.1 Inf 1.2 Inf 1.2 Inf 0.0 1.0 1.3 1.0 0.2 0.7 1.3 Inf</span></span>
<span id="cb39-9"><a href="#cb39-9"></a><span class="co">##       F 0.7 1.1 1.1 1.5 0.0 1.8 0.2 1.3 0.2 1.4 1.1 0.1 0.2 0.1 1.2 0.4 0.2 1.4</span></span>
<span id="cb39-10"><a href="#cb39-10"></a><span class="co">##       G 0.6 1.2 1.2 1.5 0.0 1.7 0.1 1.2 0.1 1.4 1.1 0.1 0.2 0.1 1.3 0.4 0.2 1.3</span></span>
<span id="cb39-11"><a href="#cb39-11"></a><span class="co">##        control</span></span>
<span id="cb39-12"><a href="#cb39-12"></a><span class="co">## treated   Z</span></span>
<span id="cb39-13"><a href="#cb39-13"></a><span class="co">##       A 0.3</span></span>
<span id="cb39-14"><a href="#cb39-14"></a><span class="co">##       B 0.3</span></span>
<span id="cb39-15"><a href="#cb39-15"></a><span class="co">##       C 1.5</span></span>
<span id="cb39-16"><a href="#cb39-16"></a><span class="co">##       D Inf</span></span>
<span id="cb39-17"><a href="#cb39-17"></a><span class="co">##       E 0.4</span></span>
<span id="cb39-18"><a href="#cb39-18"></a><span class="co">##       F 1.4</span></span>
<span id="cb39-19"><a href="#cb39-19"></a><span class="co">##       G 1.5</span></span></code></pre></div>
<p>Entries of <code>Inf</code> or <code>NaN</code> in a distance matrix are interpreted as forbidden matches. Thus</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">pairmatch</span>(cap.dist <span class="op">+</span><span class="st"> </span><span class="kw">caliper</span>(cap.dist, <span class="dv">2</span>), <span class="dt">data =</span> nuke.nopt)</span></code></pre></div>
<p>matches on <code>cap</code>, insisting that paired units not differ by more than 2 pooled SDs in <code>cap</code>. If you would prefer to set a requirement on how much paired units can differ in <code>cap</code> in its original units, rather than standard units, then you would have to create <code>cap.dist</code> in a somewhat different way. There’s an example on the help page for <code><a href="../reference/caliper-methods.html">caliper()</a></code>. Enter <code><a href="../reference/caliper-methods.html">help(caliper)</a></code> at the <em>R</em> command line.</p>
</div>
<div class="section level3">
<h3 id="trying-it-out-on-your-own">Trying it out on your own<a class="anchor" aria-label="anchor" href="#trying-it-out-on-your-own"></a>
</h3>
<p>Below are some suggestions of other data sets you could try this out on.</p>
<p>For another interesting (toy) data set, you can use the “tli” data set in the <strong><a href="https://cran.r-project.org/package=xtable" class="external-link">xtable</a></strong> package.</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">install.packages</span>(<span class="st">"xtable"</span>) <span class="co"># if not already installed</span></span>
<span id="cb41-2"><a href="#cb41-2"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">data</span>(tli, <span class="dt">package =</span> <span class="st">"xtable"</span>)</span></code></pre></div>
<p>You might compare test scores for kids with <code>disadvg=="YES"</code> to those of kids with <code>disadvg=="NO"</code> using propensity matching, in some combination with Mahalanobis matching and caliper matching. A check of propensity overlap may inform your decision as to whether to include a propensity caliper. Be sure to check for balance, and do check the structure of the matched sets.</p>
<p>Three sources of  data can be gotten as follows. First, Paul Rosenbaum has collected many of the data sets discussed in his <em>Design of Observational Studies</em> (2010) into the <strong><a href="https://cran.r-project.org/package=DOS" class="external-link">DOS</a></strong> and <strong><a href="https://cran.r-project.org/package=DOS2" class="external-link">DOS2</a></strong> packages.</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">install.packages</span>(<span class="st">"DOS"</span>) <span class="co"># if not already installed</span></span>
<span id="cb42-2"><a href="#cb42-2"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">install.packages</span>(<span class="st">"DOS2"</span>) <span class="co"># if not already installed</span></span>
<span id="cb42-3"><a href="#cb42-3"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">data</span>(<span class="dt">package =</span> <span class="st">"DOS"</span>)</span>
<span id="cb42-4"><a href="#cb42-4"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">data</span>(<span class="dt">package =</span> <span class="st">"DOS2"</span>)</span></code></pre></div>
<p>Second, the “lalonde” data set, discussed by Lalonde (1986, <em>Am. Econom. Rev.</em>), Dehejia and Wahba (1999, <em>JASA</em>) and Smith and Todd (2005, <em>J. Econom.</em>), is bundled with several <em>R</em> packages, including <strong><a href="https://cran.r-project.org/package=arm" class="external-link">arm</a></strong> and <strong><a href="https://cran.r-project.org/package=Matching" class="external-link">Matching</a></strong>. To get it:</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">install.packages</span>(<span class="st">"arm"</span>) <span class="co"># if not already installed</span></span>
<span id="cb43-2"><a href="#cb43-2"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">data</span>(lalonde, <span class="dt">package =</span> <span class="st">"arm"</span>)</span>
<span id="cb43-3"><a href="#cb43-3"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">help</span>(<span class="st">"lalonde"</span>, <span class="dt">package =</span> <span class="st">"arm"</span>)</span></code></pre></div>
<p>Third, the data used by Connors et al (1996, <em>J. Am. Med. Assoc.</em>) to examine costs, benefits and risks associated with right heart catheterization is bundled with Frank Harrell and collaborators’ <strong><a href="https://cran.r-project.org/package=Hmisc" class="external-link">Hmisc</a></strong> package.</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">install.packages</span>(<span class="st">"Hmisc"</span>) <span class="co"># if not already installed</span></span>
<span id="cb44-2"><a href="#cb44-2"></a><span class="op">&gt;</span><span class="st"> </span>Hmisc<span class="op">:::</span><span class="kw">getHdata</span>(rhc, <span class="dt">what =</span> <span class="st">"all"</span>)</span></code></pre></div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Ben Hansen, Mark Fredrickson, Josh Errickson, Josh Buckner.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.3.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
